import subprocess
import os
import argparse

def main(args):
    root = args.root
    model_name = args.model_name
    save_root = args.save_root

    all_directories = [d for d in os.listdir(root) if os.path.isdir(os.path.join(root, d))]

    for d in all_directories:
        images_root = os.path.join(root, d)
        # label_path = os.path.join(images_root, "labels.txt")
        save_dir = os.path.join(save_root, d)
        os.makedirs(save_dir, exist_ok=True)

        command = [
            "python",
            "main.py",
            "--model_name",
            model_name,
            "--save_dir",
            save_dir,
            "--images_root",
            images_root
        ]
        subprocess.run(command)

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Your script description.")
    parser.add_argument("--root", type=str, default="./demo", help="Root directory")
    parser.add_argument("--model_name", type=str, default="vit", help="Model name")
    parser.add_argument("--save_root", type=str, default="./test_output", help="Save root directory")

    args = parser.parse_args()
    main(args)

